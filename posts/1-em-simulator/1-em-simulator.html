---
title: Real-time EM Simulator
tags: posts
description: |
  A real-time electromagnetic simulator built in JavaScript using GPU computation,
  this project visualizes how electric and magnetic fields respond to the movement
  of a charge controlled by the user’s cursor.
layout: post.njk
permalink: /posts/emsim/
video: /images/post1.webm

---
<link rel="stylesheet" href="styles.css">
<script src="https://cdn.jsdelivr.net/npm/gpu.js@latest/dist/gpu-browser.min.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script src="js/kernels.js"></script>
<script src="js/environments.js"></script>
<script defer src="js/main.js"></script>


<main> 
    <div class="ps-app">
        
        <div class="ps-col ps-graphic">
            <canvas id="canvas"></canvas><br>
        </div>
        
        <div class="ps-col ps-controls">
            
            
        </b>
        Framerate: <span id="gputime-text" class="fps">0</span>FPS
        <span class="reset-prompt" id="reset-prompt">Press R to reset fields or </span>
        <button class="ps-button" onclick="clearFields()">Reset fields</button>
        <span> Set dielectric enviorment</span>
        <button class="ps-button set-vacuum" onclick="setEnvVacuum()">Vacuum</button>
        <button class="ps-button set-half-dielectric" onclick="setEnvHalfDielectric()">Half dielectric</button>
        <button class="ps-button set-circle" onclick="setEnvCircle()">Circle</button>
        <button class="ps-button set-parabolic-mirror" onclick="setEnvParabolicMirror()">Parabolic mirror</button>
        <button class="ps-button set-double-slit" onclick="setEnvDoubleSlit()">Double slit</button>
        
        <section class="project-description">
            <p>
                The <span style="color:red;">electric field (E)</span> is a field that exists at every point in space, representing 
                how a charged particle would be pushed or pulled if placed there. Similarly, the <span style="color:green;">
                    magnetic field (B)</span> exists everywhere and describes how moving charges would be affected at each point.
                    Both fields are continuous throughout space, and they interact with each other to form the full 
                    electromagnetic field that governs how electric and magnetic effects propagate. Their values are determined 
                    by the presence of charged particles and their movements.
                </p>
                <p>
                    Visualizing <span style="color:red;">electric</span> and <span style="color:green;">magnetic</span> fields is 
                    challenging because, unlike waves in water or other physical phenomena we can directly see, these fields 
                    exist everywhere in space and are invisible to the naked eye. Their effects are only noticeable through 
                    the forces they exert on charges, which makes developing an intuition about how they behave around particles 
                    difficult. Understanding concepts like field lines, wave propagation, and interference requires abstract 
                    thinking and mathematical reasoning. This application helps make these invisible fields tangible by showing 
                    them in real time, allowing users to see how the <span style="color:red;">electric</span> and 
                    <span style="color:green;">magnetic</span> fields evolve, interact, and respond to sources and materials. 
                    Areas where both are strong are highlighted in <span style="color:yellow;">yellow</span>.
                </p>
                <p>
                    The behavior of <span style="color:red;">E</span> and <span style="color:green;">B</span> fields is described 
                    by <strong>Maxwell’s equations</strong>, which summarize how electric charges and currents produce 
                    electric and magnetic fields, and how these fields propagate through space. These equations explain the 
                    relationship between changing <span style="color:red;">electric</span> fields and <span style="color:green;">magnetic</span> 
                    fields, forming the foundation for understanding all electromagnetic phenomena.
                </p>
                <p>
                    This simulation models a two-dimensional slice of an electromagnetic field, calculating only the components 
                    <span style="color:red;">Ex</span>, <span style="color:red;">Ey</span>, and <span style="color:green;">Bz</span>. 
                    Users can control a charged particle, represented as a blue circle, by moving the mouse, which acts as a 
                    dynamic source of electric and magnetic fields. The visualization uses colors to show field strengths: 
                    <span style="color:red;">red for electric field</span>, <span style="color:green;">green for magnetic field</span>, 
                    and <span style="color:yellow;">yellow</span> for regions where both fields overlap.
                </p>
            </section>
        </div>    
    </div>
    <section class="project-description">
        <h2>What's being solved?</h2>
        
        <p>
            The simulation is iteravely solving in real time for <span style="color:red;">$\mathbf{E}$</span> and
            <span style="color:green;"">$\mathbf{B}$</span> taking into account the
            values of <span style="color:cyan;"">$\rho$</span> and <span style="color:cyan;"">$\mathbf{J}$</span>
            determined by the position and velocity of the blue charge controlled by the mouse pointer:
            
            $$\nabla \cdot \mathbf{\color{red}{E}} = \frac{\color{cyan}{\rho}}{\varepsilon}$$
            $$\nabla \cdot \mathbf{\color{green}{B}} = 0$$
            $$\nabla \times \mathbf{\color{red}{E}} = -\frac{\partial \mathbf{\color{green}{B}}}{\partial t}$$
            $$\nabla \times \mathbf{\color{green}{B}} = \mu_0 \mathbf{\color{cyan}{J}} + \mu_0 \varepsilon \frac{\partial \mathbf{\color{red}{E}}}{\partial t}$$
        </p>
        
        The value of $\mu_0$ is fixed and the value of $\varepsilon$ is dependent on the dielectric configuration.
        
        <h2>What is ACTUALLY being solved?</h2>
        <p>
            In this simulation, only a finite number of points of the fields are being simulated.
            Only <span style="color:red;">$E_x$</span>, <span style="color:red;">$E_y$</span> 
            and <span style="color:green;">$H_z$</span> are taken into account, and are discretized in the
            following way: <br>
            
            <figure style="text-align: center;">        
                <img src="images/grid.png" width="400"> <br>
            </figure>
            <p>This allows the curl $\left(\nabla \times \right)$ calculations to be most accurate where they are needed.
                This is called a Yee latice and the method is called Finite-difference time-domain method (FDTD).</p>
                
                <p>A complete tutorial on the method can be referenced in the excelent open licensed book by John B. Schneider
                    <a href="https://eecs.wsu.edu/~schneidj/ufdtd/ufdtd.pdf" style="color: #f40; text-decoration: none;" target="_blank" rel="noopener noreferrer">
                        Understanding the Finite-Difference Time-Domain Method</a> </p>
                        
                        <h2>How does it work?</h2>
                        <p>
                            To be able to update the grid several times per second, some access to parallel computing is needed, especially if
                            the only tool available is Javascript. To overcome this I used the <a href="https://gpu.rocks" style="color: #f40; text-decoration: none;" target="_blank" rel="noopener noreferrer">
                                GPU.JS</a> library.
                            </p>
                            
                            <h2>Wait, why can I make the particle move faster than the speed of light?</h2>
                            <p>
                                Technically, yes, it's travelling faster than the speed of light *in the arbitrary medium it's being simulated*.
                                The simulation is being carried out with normalized values for $\mu$ and $\varepsilon$, one may consider the
                                actual values of these parameters very large, giving a very small value for $v = 1/\sqrt{\varepsilon \mu}$
                            </p>
                            
                        </main>